<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kgc.dao.KcDispatchMapper">
    <select id="getKcDispathList" resultType="KcDispatch">
        select id, code, subject, price, beforeWarehouseId,(select name from base_storehouse where kd.beforeWarehouseId = base_storehouse.id) as beforeWareName,
        AimWarehouseId,(select name from base_storehouse where kd.AimWarehouseId = base_storehouse.id) as AimWareName,
        remark, approverBy,(select userName from sys_user where approverBy = userId) as approverName,approvalStatus, approverRemark,
        documenterBy, (select userName from sys_user where documenterBy = userId) as createName,voidState, createDate,
         updateDate, updateBy, (select userName from sys_user where kd.updateBy = userId) as updateName,orderStatus,
         (select type from order_statue where orderStatus = order_statue.id) as orderStatusResult
        from kc_dispatch kd
        <where>
            kd.isDel = 0
        <if test="code != null and code != '' ">
            and code like concat("%",#{code},"%")
        </if>
        <if test="AimWarehouseId > 0">
            and AimWarehouseId = #{AimWarehouseId}
        </if>
        <if test="beforeWarehouseId > 0">
            and beforeWarehouseId = #{beforeWarehouseId}
        </if>
        <if test="beginTime != null and beginTime != ''">
            and documenterBy BETWEEN #{beginTime} and #{endTime}
        </if>
        <if test="orderStatus > 0">
            and orderStatus=#{orderStatus}
        </if>
        <if test="approvalStatus > 0">
            and approvalStatus=#{approvalStatus}
        </if>
        <if test="subject != null and subject != '' ">
            and code like concat("%",#{subject},"%")
        </if>
        </where>
    </select>
</mapper>