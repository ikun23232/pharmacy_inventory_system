<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kgc.dao.SaleOrderMapper">
    <select id="getSaleOrderListByPage" resultType="XsOrder">
        SELECT o.id,
        orderNo,
        orderDate,
        totalNumber,
        totalPrice,
        bankAccountId,
        o.createBy,
        o.updateBy,
        o.updateDate,
        b.bandCount AS bankAccountName,
        c.userName AS createByName,
        u.userName AS updateByName
        FROM xs_order o
        LEFT JOIN sys_user c ON o.createBy = c.userId AND c.isDel = 0
        LEFT JOIN sys_user u ON o.updateBy = u.userId AND u.isDel = 0
        JOIN bank_account b ON o.bankAccountId = b.id AND b.isDel = 0
        WHERE o.isDelete = 0
        <if test="orderNo!=null and orderNo!=''">and orderNo like concat('%',#{orderNo},'%')</if>
<!--        <if test="orderDate!=null and orderDate!=''">and orderDate between #{orderDateBegin} and #{orderDateEnd}</if>-->
    </select>

    <select id="getSaleOrderByOrderNo" resultType="XsOrder">
        SELECT o.id,
               orderNo,
               orderDate,
               totalNumber,
               totalPrice,
               remark,
               c.userName AS createByName,
               ba.bandCount AS bankAccountName,
               ba.`name`,
               ba.belongBank
        FROM xs_order o,sys_user c,bank_account ba
        WHERE o.createBy = c.userId and o.bankAccountId=ba.id and o.isDelete = 0 and c.isDel=0 and ba.isDel=0
        and orderNo=#{orderNo}
    </select>

    <select id="getSaleOrderDetailByOrderNo" resultType="BaseMedicine">
        select b.id,b.name,categoryId,unitId,salePrice,specification,warning,
               un.name as unitName,mc.name as categoryName,om.quantity,om.totalPrice
        from base_medicine b,base_unit un,base_medicine_category mc,order_medicine om
        where b.categoryId=mc.id and b.unitId=un.id and b.id=om.medicineId
          and b.isDel=0 and un.isDel=0 and mc.isDel=0 and om.isDel=0
          and code=#{orderNo}
    </select>

</mapper>